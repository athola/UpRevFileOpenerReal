<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="UpRevFileOpener.MainPage"
             Title="UpRev Viewer &amp; Editor">

    <ContentPage.MenuBarItems>
        <MenuBarItem Text="File">
            <MenuFlyoutItem Text="Open" Clicked="OnOpenFile" />
            <MenuFlyoutItem x:Name="saveItem" Text="Save" Clicked="OnSaveFile" IsEnabled="False" />
            <MenuFlyoutItem x:Name="editItem" Text="Edit" Clicked="OnEditFile" IsEnabled="False" />
            <MenuFlyoutItem x:Name="closeItem" Text="Close" Clicked="OnCloseFile" IsEnabled="False" />
            <MenuFlyoutSeparator />
            <MenuFlyoutSubItem x:Name="recentFilesMenu" Text="Recent Files">
                <!-- Recent files will be added dynamically -->
            </MenuFlyoutSubItem>
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Text="Exit" Clicked="OnExitApp" />
        </MenuBarItem>
    </ContentPage.MenuBarItems>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Toolbar for formatting options -->
        <HorizontalStackLayout Grid.Row="0"
                              Padding="10"
                              Spacing="10"
                              BackgroundColor="{StaticResource Gray200}">

            <Button x:Name="btnBold"
                    Text="B"
                    FontAttributes="Bold"
                    WidthRequest="40"
                    HeightRequest="40"
                    Clicked="OnBoldClicked"
                    IsEnabled="False" />

            <Button x:Name="btnItalic"
                    Text="I"
                    FontAttributes="Italic"
                    WidthRequest="40"
                    HeightRequest="40"
                    Clicked="OnItalicClicked"
                    IsEnabled="False" />

            <Button x:Name="btnUnderline"
                    Text="U"
                    TextDecorations="Underline"
                    WidthRequest="40"
                    HeightRequest="40"
                    Clicked="OnUnderlineClicked"
                    IsEnabled="False" />

            <BoxView WidthRequest="2"
                     BackgroundColor="{StaticResource Gray400}"
                     Margin="5,0" />

            <Label Text="Font:"
                   VerticalOptions="Center"
                   Margin="10,0,0,0" />

            <Picker x:Name="comboFontFamily"
                    WidthRequest="150"
                    SelectedIndexChanged="OnFontFamilyChanged"
                    IsEnabled="False" />

            <Label Text="Size:"
                   VerticalOptions="Center"
                   Margin="10,0,0,0" />

            <Picker x:Name="comboFontSize"
                    WidthRequest="70"
                    SelectedIndexChanged="OnFontSizeChanged"
                    IsEnabled="False" />
        </HorizontalStackLayout>

        <!-- Rich Text Editor using WebView -->
        <WebView x:Name="richTextEditor"
                 Grid.Row="1"
                 BackgroundColor="White" />

        <!-- Overlay for password prompts -->
        <Grid x:Name="passwordOverlay"
              Grid.Row="0"
              Grid.RowSpan="2"
              IsVisible="False"
              BackgroundColor="#80000000">

            <Frame CornerRadius="10"
                   BorderColor="Maroon"
                   BackgroundColor="Black"
                   Padding="20"
                   HasShadow="True"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="300"
                   HeightRequest="150">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <Label x:Name="passwordPromptLabel"
                           Grid.Row="0"
                           Text="Enter password:"
                           TextColor="White"
                           HorizontalOptions="Center"
                           Margin="0,0,0,10" />

                    <Entry x:Name="passwordEntry"
                           Grid.Row="1"
                           IsPassword="True"
                           TextColor="White"
                           BackgroundColor="{StaticResource Gray600}"
                           HorizontalOptions="Fill"
                           VerticalOptions="Center" />

                    <HorizontalStackLayout Grid.Row="2"
                                          HorizontalOptions="Center"
                                          Spacing="20"
                                          Margin="0,10,0,0">
                        <Button Text="OK"
                                Clicked="OnPasswordOk"
                                WidthRequest="100" />
                        <Button Text="Cancel"
                                Clicked="OnPasswordCancel"
                                WidthRequest="100" />
                    </HorizontalStackLayout>
                </Grid>
            </Frame>
        </Grid>
    </Grid>

</ContentPage>
